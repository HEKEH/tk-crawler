<script setup lang="tsx">
import type { VNode } from 'vue';
import { Bell } from '@element-plus/icons-vue';
import { useIsWebSize } from '@tk-crawler/view-shared';
import { ElIcon, ElLink, ElTooltip } from 'element-plus';
import { computed } from 'vue';
import { Page } from '../../types';
import { useGlobalStore } from '../../utils';

const globalStore = useGlobalStore();

const errorMessage = computed<{
  title: string | VNode;
} | null>(() => {
  if (globalStore.guildAccountsManage.isAnyAccountError) {
    return {
      title: (
        <div class="flex items-center">
          某些公会账号登录已过期或出错，请前往
          <ElLink
            class="mx-1 text-xs"
            type="primary"
            underline="always"
            onClick={() => globalStore.goToPage(Page.GuildManage)}
          >
            公会管理
          </ElLink>
          及时处理
        </div>
      ),
    };
  }
  return null;
});

const isWebSize = useIsWebSize();
</script>

<template>
  <ElTooltip v-if="errorMessage" open>
    <template #content>
      <span v-if="typeof errorMessage.title === 'string'">
        {{ errorMessage.title }}
      </span>
      <component :is="errorMessage.title" v-else :is-functional="true" />
    </template>
    <ElIcon
      :size="isWebSize ? 22 : 18"
      class="text-[var(--el-color-danger)] cursor-pointer"
    >
      <Bell />
    </ElIcon>
  </ElTooltip>
</template>
