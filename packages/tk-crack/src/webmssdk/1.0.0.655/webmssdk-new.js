const fs = require('fs');
const path = require('path');

function escapeString(str) {
  return str.replace(/[\n\r\t\\"']/g, char => {
    switch (char) {
      case '\n':
        return '\\n';
      case '\r':
        return '\\r';
      case '\t':
        return '\\t';
      case '"':
        return '\\"';
      case "'":
        return "\\'";
      case '\\':
        return '\\\\';
      default:
        return char;
    }
  });
}

function batchReplaceArrayElements(
  filePath,
  array,
  arrayName,
  type = 'string',
) {
  const fileContent = fs.readFileSync(filePath, 'utf8');
  const replacements = array.reduce((acc, val, index) => {
    acc[`${arrayName}[${index}]`] = val;
    return acc;
  }, {});
  const newContent = fileContent.replace(
    new RegExp(`${arrayName}\\s*\\[\\s*\\d+\\s*\\]`, 'g'),
    match => {
      return type === 'string'
        ? `'${escapeString(replacements[match])}'`
        : replacements[match];
    },
  );
  fs.writeFileSync(`${filePath}-new`, newContent);
}

const pa = [32768, 8, 128, 0, 24, 8388608, 16, 2147483648, 1];

batchReplaceArrayElements(
  path.join(
    __dirname,
    'lf16-live-backstage.tiktokcdn.com/obj/rc-web-sdk-sg/webmssdk/1.0.0.655/webmssdk.js',
  ),
  pa,
  'pa',
  'number',
);

// const J = [
//   3863347763,
//   62,
//   214,
//   4294967295,
//   246,
//   28,
//   184,
//   2654435769,
//   6,
//   2903579748,
//   176,
//   4,
//   178,
//   16,
//   211147047,
//   256,
//   14,
//   133,
//   114,
//   194,
//   172,
//   152,
//   2633865432,
//   18,
//   167,
//   17,
//   217618912,
//   163,
//   201,
//   600974999,
//   5,
//   8,
//   1498001188,
//   228,
//   2,
//   2517678443,
//   3732962506,
//   127,
//   263,
//   141,
//   129,
//   3,
//   2157053261,
//   243,
//   238,
//   58,
//   223,
//   /\s*\(\)\s*{\s*\[\s*native\s+code\s*]\s*}\s*$/,
//   9,
//   200,
//   169,
//   3212677781,
//   261,
//   174,
//   44,
//   1451689750,
//   187,
//   159,
//   1,
//   161,
//   2718276124,
//   45,
//   12,
//   136,
//   106,
//   258,
//   148,
//   2931180889,
//   49,
//   4294967296,
//   53,
//   1196819126,
//   250,
//   254,
//   13,
//   145,
//   7,
//   15,
//   11,
//   180,
//   252,
//   10,
//   0,
//   165,
//   185100057,
//   182,
//   156,
// ];

// batchReplaceArrayElements(
//     path.join(
//         __dirname,
//         'lf16-live-backstage.tiktokcdn.com/obj/rc-web-sdk-sg/webmssdk/1.0.0.655/webmssdk.js',
//     ),
//     J,
//     'J',
//     'mixed',
// );

// const ta = [
//   1, 145523070, 26, 23, 11, 606105819, 1094730640,
//   1990404162, 1958414417, 1873313359, 117830708,
//   5, 1735328473, 718787259, 680876937, 35309556,
//   358537222, 995338651, 3, 1272893353, 722521979,
//   8, 378558, 15, 1236535329, 2022574463,
//   2054922799, 165796510, 389564586, 1926607734,
//   1530992060, 1316259209, 680876936, 51403784,
//   1732584194, 40341101, 1120210379, 640364487, 2,
//   1839030562, 1770035416, 1804603682, 1700485571,
//   20, 18, 10, 1894986606, 1051523, 681279174,
//   1044525330, 25, 198630844, 1502002290,
//   2004318071, 271733879, 57434055, 1473231341, 13,
//   0, 28, 405537848, 1200080426, 643717713,
//   1163531501, 16, 22, 271733878, 4, 176418897,
//   660478335, 1732584193, 27, 343485551, 21, 12,
//   1019803690, 373897302, 1444681467, 1309151649,
//   6, 45705983, 76029189, 568446438, 17,
//   1069501632, 42063, 9, 155497632, 530742520,
//   30611744, 14, 1126478375, 701558691, 1416354905,
//   1126891415, 187363961, 7, 1560198380, 421815835,
//   38016083,
// ];

// batchReplaceArrayElements(
//     path.join(
//         __dirname,
//         'lf16-live-backstage.tiktokcdn.com/obj/rc-web-sdk-sg/webmssdk/1.0.0.655/webmssdk.js',
//     ),
//     ta,
//     'ta',
//     'number',
// );

// const sa = [11, 7, 13, 5, 1, 9, 0, 8, 14, 3, 12, 15, 4, 6, 16, 2, 10];

// batchReplaceArrayElements(
//     path.join(
//         __dirname,
//         'lf16-live-backstage.tiktokcdn.com/obj/rc-web-sdk-sg/webmssdk/1.0.0.655/webmssdk.js',
//     ),
//     sa,
//     'sa',
//     'number',
// );

// const Gb = [
//   'RTCPeerConnection',
//   'open',
//   'invalid block type',
//   'isWebmssdk',
//   'length',
//   'close',
//   'hBytes',
//   'isArray',
//   'slice',
//   '[object Undefined]',
//   'setItem',
//   'MT Extra',
//   'stream finishing',
//   'value',
//   '[object String]',
//   '##',
//   'e1',
//   'invalid UTF-8 data',
//   'finalize',
//   'toLocaleString',
//   'Castellar',
//   'Jokerman',
//   ',',
//   'isTrusted',
//   'vivobrowser',
//   'Object.keys called on non-object',
//   '__1479382789__',
//   'report',
//   'type',
//   '/',
//   'Vrinda',
//   'map',
//   '=; expires=Mon, 20 Sep 2010 00:00:00 UTC; path=/;',
//   'hasOwnProperty',
//   'reduce',
//   'h3',
//   'now',
//   'pow',
//   'update',
//   'resultCode',
//   'mon-va.byteoversea.com',
//   'fromCharCode',
//   'createElement',
//   ' is not a function',
//   'perf',
//   'exports',
//   'setLocalDescription',
//   'charCodeAt',
//   'https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/slardar/fe/sdk-web/plugins',
//   'Savoye LET',
//   'default',
//   'kWebsocket',
//   'match',
//   '[object HTMLAllCollection]',
//   'filename too long',
//   'i',
//   'sans-serif',
//   'Illegal statement',
//   'defineProperty',
//   'Wingdings',
//   'base64',
//   'removeChild',
//   'constructor',
//   'date not in range 1980-2099',
//   'includes',
//   'name',
//   'm',
//   'hashed',
//   'l',
//   'fontSize',
//   'symbol',
//   'getItem',
//   's',
//   'n',
//   'onreadystatechange',
//   'Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.',
//   'apply',
//   'concat',
//   'invalid length/literal',
//   'error',
//   'no callback',
//   'hex',
//   'Segoe UI',
//   'JS_MD5_NO_NODE_JS',
//   'cookie',
//   'clear',
//   'join',
//   'floor',
//   'create',
//   ';',
//   'createDataChannel',
//   'prod',
//   'complete',
//   'dispatchEvent',
//   'h0',
//   "require('buffer').Buffer",
//   'boe',
//   'Colonna MT',
//   'hash',
//   'lastChanceUrl',
//   '; expires=',
//   'setUserMode',
//   'h2',
//   'first',
//   'md5',
//   'out',
//   'Futura',
//   'MS Outlook',
//   'exec',
//   'buffer',
//   'keys',
//   'splice',
//   'abort',
//   'webkitRTCPeerConnection',
//   'AVENIR',
//   'Map',
//   'slardarErrs',
//   'dictionary',
//   'JS_MD5_NO_COMMON_JS',
//   'innerHTML',
//   'JS_MD5_NO_WINDOW',
//   'https://lf16-cdn-tos.tiktokcdn-us.com/obj/static-tx/slardar/fe/sdk-web/plugins/',
//   'get',
//   'call',
//   'ty',
//   'prototype',
//   'object',
//   '==',
//   'Palatino',
//   'OPTIMA',
//   'Playbill',
//   '.',
//   'timeout',
//   'item',
//   '=',
//   'bytes',
//   'JS_MD5_NO_ARRAY_BUFFER_IS_VIEW',
//   'readyState',
//   'random',
//   'sessionStorage',
//   'JS_MD5_NO_ARRAY_BUFFER',
//   ' ',
//   'isSignalComplete',
//   'DOMContentLoaded',
//   '[object Function]',
//   'invalid zip data',
//   'input is invalid type',
//   '[object Boolean]',
//   'p',
//   'Tw Cen MT',
//   '/web/report',
//   'onicegatheringstatechange',
//   'span',
//   'Meiryo',
//   'toGMTString',
//   'from',
//   'node',
//   'return',
//   'Object',
//   '{}',
//   '?',
//   'indexOf',
//   'ConfigException',
//   'MYRIAD PRO',
//   'Gulim',
//   'setTTWebidV2',
//   'function',
//   'addEventListener',
//   'captureStackTrace',
//   'blocks',
//   'plugins',
//   'Arial Hebrew',
//   'getTime',
//   'code',
//   '__esModule',
//   '/mssdk/web_common',
//   'removeEventListener',
//   '__ac_testid',
//   'push',
//   'array',
//   'charAt',
//   'subscribe',
//   'e',
//   'key',
//   'appendChild',
//   'shift',
//   "require('crypto')",
//   'decode',
//   'send',
//   'filename',
//   'mon.tiktokv.com',
//   'body',
//   '&',
//   'substr',
//   'Tunga',
//   'split',
//   'fontFamily',
//   'isView',
//   'status',
//   'version',
//   'b',
//   'toString',
//   '[object Array]',
//   '@@iterator',
//   'err',
//   '[object Number]',
//   ' is not defined',
//   'digest',
//   '[object Object]',
//   'substring',
//   'readystatechange',
//   'versions',
//   'invalid distance',
//   'interactive',
//   'DONE',
//   '0123456789abcdef',
//   'kHttp',
//   'lastByteIndex',
//   'candidate',
//   'f',
//   '|',
//   'Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.',
//   'sort',
//   'iterator',
//   'info',
//   '52',
//   'Set',
//   'globalThis',
//   'offsetWidth',
//   'Parchment',
//   'CordiaUPC',
//   'encode',
//   'test',
//   'start',
//   'init',
//   'setTTWid',
//   'host',
//   'message',
//   'stream finished',
//   'set',
//   '0',
//   'mon16-normal-useast5.tiktokv.com',
//   'data',
//   'Malformed string',
//   'pop',
//   'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',
//   'serif',
//   'finalized',
//   'createOffer',
//   'subarray',
//   'done',
//   'Arguments',
//   'POST',
//   '_xex',
//   '&U',
//   'monospace',
//   'iceGatheringState',
//   'propertyIsEnumerable',
//   'Aparajita',
//   'trim',
//   'number',
//   'beforeunload',
//   'h1',
//   'buffer8',
//   'Trebuchet MS',
//   'getReferer',
//   'passive',
//   'utf8',
//   'string',
//   'mmmmmmmmmmlli',
//   '72px',
//   'r',
//   'catch',
//   'unexpected EOF',
//   'setTTWebid',
//   'onicecandidate',
//   'PLUGIN',
//   'no stream handler',
//   'localStorage',
//   '2M',
//   'Constantia',
//   '/web/common',
//   'undefined',
//   'min',
//   'Leelawadee',
//   'setRequestHeader',
//   'next',
//   'arrayBuffer',
//   'max',
//   'SimSun-ExtB',
//   'mozRTCPeerConnection',
//   'suffixes',
//   'offsetHeight',
//   '; path=/;',
//   'forEach',
//   'frontierSign',
//   'Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.',
//   '',
//   'reportUrls',
//   'extra field too long',
//   'setOptions',
//   'withCredentials',
//   'IrisUPC',
//   'isPrototypeOf',
//   'xmst',
//   'd',
//   'valueOf',
//   'Sylfaen',
// ];

// batchReplaceArrayElements(
//   path.join(__dirname, "lf16-live-backstage.tiktokcdn.com/obj/rc-web-sdk-sg/webmssdk/1.0.0.655/webmssdk.js"),
//   Gb,
//   'Gb',
//   'string'
// );
